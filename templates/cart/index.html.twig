{% extends 'base.html.twig' %}

{% block title %}Shopping Cart{% endblock %}

{% block body %}
    <h1>ðŸ›’ Shopping Cart</h1>

    {% for message in app.flashes('success') %}
        <div style="padding: 1rem; background: #d4edda; color: #155724; border: 1px solid #c3e6cb; border-radius: 4px; margin-bottom: 1rem;">
            {{ message }}
        </div>
    {% endfor %}

    {% if cartItems is empty %}
        <div style="text-align: center; padding: 3rem; background: #f8f9fa; border-radius: 8px; margin-top: 2rem;">
            <p style="font-size: 1.2rem; color: #6c757d;">Your cart is empty</p>
            <a href="{{ path('app_product_catalog') }}" class="btn" style="margin-top: 1rem;">
                Continue Shopping
            </a>
        </div>
    {% else %}
        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem; margin-top: 2rem;">
            {# Cart Items #}
            <div>
                {% for item in cartItems %}
                    <div class="cart-item" data-cart-item data-product-id="{{ item.product.id }}" style="display: grid; grid-template-columns: 100px 1fr auto; gap: 1rem; padding: 1rem; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 1rem; align-items: center;">
                        {# Product Image #}
                        <div>
                            {% if item.product.image %}
                                <img src="{{ asset('uploads/products/' ~ item.product.image) }}" alt="{{ item.product.name }}" style="width: 100px; height: 100px; aspect-ratio: 1/1; object-fit: cover; border-radius: 4px;">
                            {% else %}
                                <div style="width: 100px; height: 100px; background: #ecf0f1; display: flex; align-items: center; justify-content: center; border-radius: 4px;">
                                    <span style="color: #95a5a6;">No image</span>
                                </div>
                            {% endif %}
                        </div>

                        {# Product Info #}
                        <div>
                            <h3 style="margin: 0 0 0.5rem 0;">
                                <a href="{{ path('app_product_show', {id: item.product.id}) }}" style="color: #2c3e50; text-decoration: none;">
                                    {{ item.product.name }}
                                </a>
                            </h3>
                            <p style="color: #7f8c8d; margin: 0;">${{ item.product.price }} each</p>
                            <p style="margin: 0.5rem 0 0 0;"><strong>Subtotal: $<span class="item-total">{{ (item.product.price * item.quantity)|number_format(2) }}</span></strong></p>
                        </div>

                        {# Quantity & Actions #}
                        <div style="text-align: right;">
                            <form method="post" action="{{ path('app_cart_update', {id: item.product.id}) }}" data-product-id="{{ item.product.id }}" style="display: inline-block; margin-bottom: 0.5rem;">
                                <input type="hidden" name="_token" value="{{ csrf_token('cart') }}">
                                <label style="display: block; margin-bottom: 0.25rem; font-size: 0.9rem;">Quantity:</label>
                                <input type="number" name="quantity" data-action="update-quantity" data-product-id="{{ item.product.id }}" value="{{ item.quantity }}" min="1" max="99" 
                                       style="width: 60px; padding: 0.25rem; border: 1px solid #ddd; border-radius: 4px;">
                                <button type="submit" class="btn" style="padding: 0.25rem 0.75rem; margin-left: 0.5rem;">
                                    Update
                                </button>
                            </form>

                            <form method="post" action="{{ path('app_cart_remove', {id: item.product.id}) }}" data-action="remove-from-cart" data-product-id="{{ item.product.id }}" style="display: inline-block;">
                                <input type="hidden" name="_token" value="{{ csrf_token('cart') }}">
                                <button type="submit" style="background: #e74c3c; color: white; border: none; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer;">
                                    Remove
                                </button>
                            </form>
                        </div>
                    </div>
                {% endfor %}

                {# Clear Cart Button #}
                <form method="post" action="{{ path('app_cart_clear') }}" style="margin-top: 1rem;">
                    <input type="hidden" name="_token" value="{{ csrf_token('cart') }}">
                    <button type="submit" style="background: #95a5a6; color: white; border: none; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer;">
                        Clear Cart
                    </button>
                </form>
            </div>

            {# Cart Summary #}
            <div>
                {% include 'cart/_cart_summary.html.twig' %}
            </div>
        </div>
    {% endif %}
{% endblock %}